# Тестування Frontend

Цей документ описує, як запускати та працювати з тестами frontend частини проєкту.

## Встановлені бібліотеки для тестування

- **Jest** - фреймворк для тестування
- **@testing-library/react** - бібліотека для тестування React компонентів
- **@testing-library/jest-dom** - додаткові матчери для Jest
- **@testing-library/user-event** - симуляція користувацьких дій

## Структура тестів

```
frontend/src/
├── setupTests.ts                    # Налаштування тестового середовища
├── services/
│   └── api.test.ts                 # Тести для API сервісів
└── pages/
    ├── UsersPage.test.tsx          # Тести для сторінки користувачів
    └── PlansPage.test.tsx          # Тести для сторінки планів
```

## Запуск тестів

### Запустити всі тести один раз
```bash
cd frontend
npm test -- --watchAll=false
```

### Запустити тести у watch режимі (автоматичний перезапуск при змінах)
```bash
cd frontend
npm test
```

### Запустити тести з coverage (покриття коду)
```bash
cd frontend
npm test -- --coverage --watchAll=false
```

## Опис тестів

### API тести ([api.test.ts](src/services/api.test.ts))

Тестують HTTP запити до backend API:

**usersApi:**
- ✅ Отримання всіх користувачів
- ✅ Отримання користувача за ID
- ✅ Створення нового користувача
- ✅ Оновлення користувача
- ✅ Видалення користувача

**plansApi:**
- ✅ Отримання всіх планів підписок
- ✅ Отримання плану за ID
- ✅ Створення нового плану
- ✅ Оновлення плану
- ✅ Видалення плану

**paymentApi:**
- ✅ Симуляція платежу
- ✅ Отримання всіх транзакцій
- ✅ Отримання транзакцій користувача

### UsersPage тести ([UsersPage.test.tsx](src/pages/UsersPage.test.tsx))

Тестують компонент сторінки управління користувачами:

**Рендеринг:**
- ✅ Відображення індикатора завантаження
- ✅ Відображення заголовка та кнопки "Додати користувача"
- ✅ Відображення таблиці з користувачами
- ✅ Відображення статусів підписок

**Створення користувача:**
- ✅ Відкриття діалогу створення
- ✅ Заповнення форми та створення користувача
- ✅ Закриття діалогу

**Оновлення користувача:**
- ✅ Відкриття діалогу редагування
- ✅ Оновлення даних користувача

**Видалення користувача:**
- ✅ Показ підтвердження перед видаленням
- ✅ Видалення після підтвердження

**Форматування даних:**
- ✅ Форматування дат
- ✅ Відображення відсутніх даних

### PlansPage тести ([PlansPage.test.tsx](src/pages/PlansPage.test.tsx))

Тестують компонент сторінки управління планами підписок:

**Рендеринг:**
- ✅ Відображення індикатора завантаження
- ✅ Відображення заголовка та кнопки "Додати план"
- ✅ Відображення карток планів
- ✅ Відображення цін та періодів

**Створення плану:**
- ✅ Відкриття діалогу створення
- ✅ Створення місячного плану
- ✅ Створення річного плану
- ✅ Закриття діалогу

**Оновлення плану:**
- ✅ Відкриття діалогу редагування
- ✅ Оновлення даних плану

**Видалення плану:**
- ✅ Показ підтвердження перед видаленням
- ✅ Видалення після підтвердження

**Функції утиліт:**
- ✅ Розрахунок місячної вартості для річних планів
- ✅ Відображення чіпів для різних періодів

## Результати тестування

```
Test Suites: 3 passed, 3 total
Tests:       49 passed, 49 total
Snapshots:   0 total
Time:        ~7-8 seconds
```

## Особливості реалізації

### Мокування API

API запити мокуються за допомогою `jest.mock()`. Це дозволяє тестувати компоненти без реального backend сервера.

### Тестування користувацьких взаємодій

Використовується `@testing-library/user-event` для симуляції натискань, введення тексту та інших дій користувача.

### Асинхронні тести

Всі тести, що працюють з API або React hooks, використовують `waitFor()` для очікування асинхронних операцій.

## Приклад тесту

```typescript
it('повинен створити нового користувача', async () => {
  const user = userEvent.setup();
  const newUser = {
    id: '3',
    name: 'Петро Сидоренко',
    email: 'petro@example.com',
  };

  mockUsersApi.create.mockResolvedValue(newUser);

  render(<UsersPage />);

  // Відкрити діалог
  const addButton = screen.getByText('Додати користувача');
  await user.click(addButton);

  // Заповнити форму
  const nameInput = screen.getByLabelText("Ім'я");
  await user.type(nameInput, 'Петро Сидоренко');

  // Зберегти
  const createButton = screen.getByText('Створити');
  await user.click(createButton);

  // Перевірити, що API було викликано
  await waitFor(() => {
    expect(mockUsersApi.create).toHaveBeenCalledWith({
      name: 'Петро Сидоренко',
      email: 'petro@example.com',
    });
  });
});
```

## Поради для написання нових тестів

1. **Тестуйте поведінку, а не реалізацію** - фокусуйтеся на тому, що бачить користувач
2. **Використовуйте describe() для групування** - організовуйте тести логічно
3. **Очищайте моки перед кожним тестом** - використовуйте `beforeEach()`
4. **Використовуйте waitFor()** - для асинхронних операцій
5. **Перевіряйте доступність** - використовуйте semantic queries (getByRole, getByLabelText)

## Корисні команди

```bash
# Запустити тести для конкретного файлу
npm test UsersPage.test.tsx

# Запустити тести з детальним виводом
npm test -- --verbose

# Оновити snapshots
npm test -- -u

# Показати покриття тестами
npm test -- --coverage --watchAll=false
```
