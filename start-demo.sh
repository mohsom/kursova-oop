#!/bin/bash

echo "üöÄ –ó–∞–ø—É—Å–∫ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—ó —Å–∏—Å—Ç–µ–º–∏ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –ø—ñ–¥–ø–∏—Å–∫–∞–º–∏ SaaS"
echo "=================================================="

# –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ
if [ ! -d "node_modules" ]; then
    echo "üì¶ –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π –¥–ª—è backend..."
    npm install
fi

if [ ! -d "frontend/node_modules" ]; then
    echo "üì¶ –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π –¥–ª—è frontend..."
    cd frontend
    npm install
    cd ..
fi

echo ""
echo "üîß –ó–∞–ø—É—Å–∫ backend —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ –ø–æ—Ä—Ç—É 3001..."
echo "üåê –ó–∞–ø—É—Å–∫ frontend –¥–æ–¥–∞—Ç–∫—É –Ω–∞ –ø–æ—Ä—Ç—É 3000..."
echo ""
echo "üì± Frontend –±—É–¥–µ –¥–æ—Å—Ç—É–ø–Ω–∏–π –∑–∞ –∞–¥—Ä–µ—Å–æ—é: http://localhost:3000"
echo "üîå Backend API –±—É–¥–µ –¥–æ—Å—Ç—É–ø–Ω–∏–π –∑–∞ –∞–¥—Ä–µ—Å–æ—é: http://localhost:3001"
echo ""
echo "–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å Ctrl+C –¥–ª—è –∑—É–ø–∏–Ω–∫–∏ —Å–µ—Ä–≤–µ—Ä—ñ–≤"
echo ""

# –ó–∞–ø—É—Å–∫–∞—î–º–æ backend –≤ —Ñ–æ–Ω–æ–≤–æ–º—É —Ä–µ–∂–∏–º—ñ
npm run dev &
BACKEND_PID=$!

# –ó–∞–ø—É—Å–∫–∞—î–º–æ frontend
cd frontend
npm start &
FRONTEND_PID=$!

# –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –∑—É–ø–∏–Ω–∫–∏ –ø—Ä–æ—Ü–µ—Å—ñ–≤ –ø—Ä–∏ Ctrl+C
cleanup() {
    echo ""
    echo "üõë –ó—É–ø–∏–Ω–∫–∞ —Å–µ—Ä–≤–µ—Ä—ñ–≤..."
    kill $BACKEND_PID 2>/dev/null
    kill $FRONTEND_PID 2>/dev/null
    exit 0
}

# –û–±—Ä–æ–±–∫–∞ —Å–∏–≥–Ω–∞–ª—É –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è
trap cleanup SIGINT SIGTERM

# –û—á—ñ–∫—É—î–º–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è
wait
